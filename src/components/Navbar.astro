---
import ThemeToggle from './ThemeToggle.svelte';
import { SignedIn, SignedOut, UserButton } from '@clerk/astro/components';

interface Props {
  currentPath?: string;
}
const { currentPath = '/' } = Astro.props;
---

<header class="sticky top-0 z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm border-b border-gray-100 dark:border-slate-800 transition-colors duration-200">
  <div class="container-main">
    <div class="flex items-center justify-between h-16">
      <!-- Brand -->
      <a href="/" class="flex items-center hover:opacity-80 transition-opacity">
        <img src="/Logo_long.svg" alt="DossierPrÃªt" class="h-11 w-auto dark:invert" />
      </a>

      <!-- Nav links -->
      <nav class="hidden md:flex items-center gap-1">
        <a href="/" class={`btn-ghost text-sm ${currentPath === '/' ? 'text-gray-900 dark:text-white bg-gray-50 dark:bg-slate-800' : ''}`}>
          Accueil
        </a>
        <a href="/blog" class={`btn-ghost text-sm ${currentPath.startsWith('/blog') ? 'text-gray-900 dark:text-white bg-gray-50 dark:bg-slate-800' : ''}`}>
          Blog
        </a>
        <a href="/premium" class={`btn-ghost text-sm ${currentPath === '/premium' ? 'text-gray-900 dark:text-white bg-gray-50 dark:bg-slate-800' : ''}`}>
          Premium
        </a>
        <SignedIn>
          <a href="/diagnostic" class={`btn-ghost text-sm ${currentPath === '/diagnostic' ? 'text-gray-900 dark:text-white bg-gray-50 dark:bg-slate-800' : ''}`}>
            Diagnostic
          </a>
          <a href="/dashboard" class={`btn-ghost text-sm ${currentPath === '/dashboard' ? 'text-gray-900 dark:text-white bg-gray-50 dark:bg-slate-800' : ''}`}>
            Mon espace
          </a>
        </SignedIn>
      </nav>

      <!-- CTA + Auth + ThemeToggle -->
      <div class="flex items-center gap-2">
        <ThemeToggle client:load />

        <SignedOut>
          <a href="/connexion" class="hidden sm:inline-flex items-center gap-1.5 px-4 py-2 text-sm font-medium text-gray-600 dark:text-slate-400 hover:text-gray-900 dark:hover:text-white rounded-lg transition-colors">
            Connexion
          </a>
          <a href="/premium" class="hidden sm:inline-flex items-center gap-1.5 px-4 py-2 text-sm font-semibold text-white bg-gray-900 dark:bg-slate-100 dark:text-slate-900 rounded-lg hover:bg-gray-800 dark:hover:bg-white transition-colors">
            Commencer
          </a>
        </SignedOut>

        <SignedIn>
          <a href="/dashboard" class="hidden sm:inline-flex items-center gap-1.5 px-4 py-2 text-sm font-semibold text-white bg-gray-900 dark:bg-slate-100 dark:text-slate-900 rounded-lg hover:bg-gray-800 dark:hover:bg-white transition-colors">
            Mon espace
          </a>
          <UserButton />
        </SignedIn>

        <!-- Mobile menu btn -->
        <button
          id="mobile-menu-btn"
          class="md:hidden p-2 rounded-lg text-gray-600 dark:text-slate-400 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"
          aria-label="Menu"
        >
          <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-gray-100 dark:border-slate-800 bg-white dark:bg-slate-900">
    <div class="container-main py-3 flex flex-col gap-1">
      <a href="/" class="btn-ghost justify-start text-sm">Accueil</a>
      <a href="/blog" class="btn-ghost justify-start text-sm">Blog</a>
      <a href="/premium" class="btn-ghost justify-start text-sm">Premium</a>
      <SignedIn>
        <a href="/diagnostic" class="btn-ghost justify-start text-sm">Diagnostic</a>
        <a href="/dashboard" class="btn-ghost justify-start text-sm">Mon espace</a>
      </SignedIn>
      <SignedOut>
        <a href="/connexion" class="btn-ghost justify-start text-sm">Connexion</a>
        <a href="/premium" class="btn-primary mt-2 text-sm">Commencer</a>
      </SignedOut>
    </div>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  btn?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
